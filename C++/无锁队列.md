# 无锁队列

（单读单写）

两个线程同步操作某种数据时，不能加锁；因为加锁是会拖慢效率，造成延时。

## 什么场景需要用到无锁队列？

生产者和消费者模型，**要求生产者生产的同时，进行消费**，这就要求足够的低延时，此时可以使用无锁队列

## 无锁队列的实现

```c++
#define MAX_NUMBER 1000
#define OK 0
#define ERROR -1

typedef struct _QUEUE_DATA
{
	int iData[MAX_NUMBER];
	int head;
	int tail;
}QUEUE_DATA;

QUEUE_DATA* pHead = new QUEUE_DATA;

pHead->head = 0;
pHead->tail = 0;

//从队尾加入数据，队列是一个环形队列
int push_data(QUEUE_DATA* pHead, int data)
{
	if(pHead == NULL || (pHead->head ==((pHead->tail +1) % MAX_NUMBER)))
	{
		return ERROR;
	}
	pHead->iData[pHead->tail] = data;
	pHead->tail = (pHead->tail+1) % MAX_NUMBER;
	return OK;
}

int pop_data(QUEUE_DATA* pHead)
{
	if(pHead == NULL || (pHead->head == pHead->tail))
	{
		return 	ERROR;
	}
	pHead->iData[pHead->head] = 0;
	pHead->head = (pHead->head+1)% 	MAX_NUMBER;
	return OK;
} 
```



